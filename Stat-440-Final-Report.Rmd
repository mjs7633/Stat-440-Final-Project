---
title: "Stat 440 Final Project"
author: "Matthew Secen"
date: "11/30/2021"
output: html_document
---

## Front Matter

```{r setup, include=FALSE}
rm(list = ls())
library("readxl")
library("dplyr")
library("tidyr")
library("ggplot2")
library("mosaic")
library("stats")
library("rpart")
#install.packages("partykit")
library("partykit")
```

```{r}
Happy2019_raw<- read.csv("2019.csv")
head(Happy2019_raw)

Happy2018_raw<- read.csv("2018.csv")
head(Happy2018_raw)
```


## Clean Data

```{r}
Happy2019 <-
  Happy2019_raw %>%
  rename(happiness_rank = Overall.rank,
    country = Country.or.region,
    score = Score,
    gdp_per_capita = GDP.per.capita,
    social_support = Social.support,
    life_expectancy = Healthy.life.expectancy,
    freedom = Freedom.to.make.life.choices,
    generosity = Generosity,
    corruption = Perceptions.of.corruption
) %>%
  mutate(happy = as.factor(ifelse(score >= 5, "yes", "no")))

Happy2019


Happy2018 <-
  Happy2018_raw %>%
  rename(happiness_rank = Overall.rank,
    country = Country.or.region,
    score = Score,
    gdp_per_capita = GDP.per.capita,
    social_support = Social.support,
    life_expectancy = Healthy.life.expectancy,
    freedom = Freedom.to.make.life.choices,
    generosity = Generosity,
    corruption = Perceptions.of.corruption
) %>%
  mutate(happy = as.factor(ifelse(score >= 5, "yes", "no")))

Happy2018
```


## Partition the Data
```{r}
set.seed(440)

n <-nrow(Happy2019)
test_idx <- sample.int(n, size = round(.25*n))

train <- Happy2019[-test_idx,]
nrow(train)
test <- Happy2019[test_idx,]
nrow(test)

#pairs(train)
```


### Null Model
```{r}
mod_null <- tally(~ happy, data = train)
mod_null
```



### Decision Tree (simple)
```{r}
rpart(happy ~ gdp_per_capita, data = train)
```

```{r}
split <- .675 # first split from simple `rpart`

train %>%
  mutate(elevated_happiness = gdp_per_capita >= split) %>%
  ggplot(aes(x = gdp_per_capita, y = happy)) + 
  geom_point(aes(color = elevated_happiness, alpha =.04)) + 
  geom_vline(xintercept = split, color = "blue", lty = 2)
```



### Decision Tree (Complete)
```{r}
mod_tree <- rpart(happy ~ gdp_per_capita + social_support + life_expectancy + freedom + generosity + corruption, data = train)
mod_tree
```

```{r}
plot(as.party(mod_tree))
```

```{r}
printcp(mod_tree)
```

```{r}
train_tree <- 
  train %>%
  mutate(happy_dtree = predict(mod_tree, type = "class"))

confusion <- tally(happy_dtree ~ happy, data = train_tree, format = "count")
confusion
```

```{r}
dtree_acc <- sum(diag(confusion)) / nrow(train) * 100
dtree_acc
```





### K-Nearest Neighbor

```{r}
#install.packages('mdsr')
library(mdsr)
#install.packages('nycflights13')
library(nycflights13)
library(tidyverse)
library(lubridate)
library(mosaic)
library(googlesheets)
library(babynames)
library(Hmisc)
library(dplyr)
#install.packages('Lahman')
library(Lahman)
library(rvest)
library(methods)
library(readr)
library(rpart)
library(partykit)
#install.packages('randomForest')
library(randomForest)
library(tibble)
library(class)
#install.packages('e1071')
library(e1071)
library(nnet)
#install.packages("ROCR")
library(ROCR)
#install.packages("NHANES")
library(NHANES)

```


```{r}
require(class)
Happy2019$gdp_per_capita<-as.numeric(as.integer(factor(Happy2019$gdp_per_capita)))
train_quant <- 
  Happy2019 %>%
  select(gdp_per_capita)
# KNN classifier


happy_knn <- knn(train = train_quant, test = train_quant, cl = Happy2019$happy, k = 5)
# confusion matrix

confusion <- tally(happy_knn ~ happy, data = Happy2019, format = "count")


knn_acc <- sum(diag(confusion)) / nrow(train_quant) * 100
knn_acc
```






